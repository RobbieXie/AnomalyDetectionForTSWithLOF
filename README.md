# AnomalyDetectionForTSWithLOF

本方法重新对LOF算法中第k距离的计算方法进行了定义，并通过比较每个服务实例的局部可达密度与其周围服务实例的局部可达密度来判断服务实例是否出现异常。首先，本文对改进后的相关定义进行介绍：
定义4.5 服务实例的第k距离
服务实例p的第k距离，记作〖dist〗_k (p)，为距离实例p最近的第k个实例到实例p的距离，k≥1。若距离最近的第k个实例为q，则〖dist〗_k (p)=SD(p,q)。
定义4.6 服务实例的k邻域
服务实例p的k邻域，记作N_k (p)，为与服务实例p的距离不超过〖dist〗_k (p)的所有服务实例所组成的集合。N_k (p)中的每个服务实例称为p的k邻域实例，N_k (p)中服务实例的个数 |N_k (p)|≥k。
定义4.7 服务实例间的可达距离
给定服务实例p，则服务实例q到p的第k可达距离，记作〖rd〗_k (p,q)，为〖dist〗_k (q)与SD(p,q)中较大的距离，即〖rd〗_k (p,q)=max{〖dist〗_k (q),SD(p,q)}。
定义4.8 服务实例的局部可达密度
服务实例p的局部可达密度，记作〖lrd〗_k (p)，为服务实例p的所有k邻域实例到其平均可达距离的倒数，其计算方法如公式4.10所示:
〖lrd〗_k (p)=1/((∑_(q∈N_k (p))▒〖〖rd〗_k (p,q) 〗)/|N_k (p)| )                 (4.10)
定义4.9 服务实例的局部异常因子
服务实例p的局部异常因子，记作〖lof〗_k (p)，为实例p的所有k邻域实例的局部可达密度与其自身局部可达密度比值的平均数，其计算方法如公式4.11所示:
〖lof〗_k (p)=(∑_(q∈N_k (p))▒〖((〖lrd〗_k (q))/(〖lrd〗_k (p) ))〗)/|N_k (p)|                   (4.11)
基于上述定义，在设定好k值的情况下即可求得每个服务实例的局部异常因子的值。对于服务实例p的局部异常因子〖lof〗_k (p)值而言，如果该值越接近于1，则表明实例p与其邻域实例的密度越为接近，它们也就更可能属于同一簇；如果该值越小于1，则表明实例p的局部密度越大于其邻域实例的密度；如果该值越大于1，则表明实例p的局部密度越小于其邻域实例的密度，该实例也就越有可能是一个异常实例。之后，再通过设定阈值的方法来对实例异常进行检测，例如当〖lof〗_k (p)>2时，则判定其为异常并进行告警。
